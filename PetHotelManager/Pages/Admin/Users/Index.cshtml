@page "/admin/users"
@model PetHotelManager.Pages.Admin.Users.IndexModel
@{
    ViewData["Title"] = "Quản lý Người dùng";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
    <h1>@ViewData["Title"]</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a asp-page="Create" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-plus-circle-fill"></i>
            Thêm mới Người dùng
        </a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th scope="col">Tên đăng nhập</th>
                <th scope="col">Họ và tên</th>
                <th scope="col">Email</th>
                <th scope="col">Vai trò</th>
                <th scope="col">Trạng thái</th>
                <th scope="col" class="text-end">Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model.UserList)
            {
                <tr>
                    <td>@user.UserName</td>
                    <td>@user.FullName</td>
                    <td>@user.Email</td>
                    <td>@string.Join(", ", user.Roles)</td>
                    <td>
                        @if (user.IsActive)
                        {
                            <span class="badge bg-success">Hoạt động</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">Vô hiệu hóa</span>
                        }
                    </td>
                    <td class="text-end">
                        <form method="post" class="d-inline">
                            <a asp-page="./Edit" asp-route-id="@user.Id" class="btn btn-sm btn-outline-secondary">Sửa</a>

                            @if (user.IsActive)
                            {
                                <button type="submit" asp-page-handler="ToggleStatus" asp-route-id="@user.Id" class="btn btn-sm btn-outline-warning">Vô hiệu hóa</button>
                            }
                            else
                            {
                                <button type="submit" asp-page-handler="ToggleStatus" asp-route-id="@user.Id" class="btn btn-sm btn-outline-success">Kích hoạt</button>
                            }

                            <!-- Nút Xóa, kích hoạt modal -->
                            <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-@user.Id">
                                Xóa
                            </button>
                        </form>
                    </td>
                </tr>

                <!-- Modal Xác nhận Xóa cho từng user -->
                <div class="modal fade" id="deleteModal-@user.Id" tabindex="-1" aria-labelledby="deleteModalLabel-@user.Id" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel-@user.Id">Xác nhận Xóa</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Bạn có chắc chắn muốn xóa vĩnh viễn người dùng <strong>@user.UserName</strong>? Hành động này không thể hoàn tác.
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <form method="post">
                                    <button type="submit" asp-page-handler="Delete" asp-route-id="@user.Id" class="btn btn-danger">Xóa vĩnh viễn</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </tbody>
    </table>
</div>