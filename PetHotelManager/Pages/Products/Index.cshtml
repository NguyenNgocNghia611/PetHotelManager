@page "/products"
@model PetHotelManager.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω T·ªìn kho";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-3">
    <h1>üì¶ @ViewData["Title"]</h1>
    <div class="btn-toolbar">
        <a asp-page="/Inventory/Receive" class="btn btn-sm btn-success me-2">
            <i class="bi bi-box-arrow-in-down"></i> Nh·∫≠p kho
        </a>
        <a asp-page="Create" class="btn btn-sm btn-primary">
            <i class="bi bi-plus-circle-fill"></i> Th√™m s·∫£n ph·∫©m
        </a>
    </div>
</div>

@* ‚≠ê TH√äM: Banner c·∫£nh b√°o *@
@if (Model.LowStockCount > 0)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>‚ö†Ô∏è C·∫£nh b√°o:</strong>
        <a asp-page="Alerts" class="alert-link">
            @Model.LowStockCount s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng
        </a>. Nh·∫•p ƒë·ªÉ xem chi ti·∫øt.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@* ‚≠ê TH√äM: B·ªô l·ªçc *@
<form method="get" class="row g-3 mb-3">
    <div class="col-md-4">
        <div class="input-group">
            <span class="input-group-text">üîç</span>
            <input type="text" class="form-control" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
                   asp-for="SearchTerm" />
        </div>
    </div>
    <div class="col-md-3">
        <select class="form-select" asp-for="CategoryFilter">
            <option value="">-- T·∫•t c·∫£ danh m·ª•c --</option>
            <option value="Thu·ªëc">Thu·ªëc</option>
            <option value="Th·ª©c ƒÉn">Th·ª©c ƒÉn</option>
            <option value="Ph·ª• ki·ªán">Ph·ª• ki·ªán</option>
            <option value="ChƒÉm s√≥c">ChƒÉm s√≥c</option>
            <option value="ƒê·ªì ch∆°i">ƒê·ªì ch∆°i</option>
        </select>
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-secondary w-100">T√¨m ki·∫øm</button>
    </div>
    <div class="col-md-3">
        <a asp-page="Index" class="btn btn-outline-secondary w-100">X√≥a b·ªô l·ªçc</a>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped table-hover table-sm">
        <thead>
            <tr>
                <th scope="col">S·∫£n ph·∫©m</th>
                <th scope="col">Danh m·ª•c</th>
                <th scope="col" class="text-end">Gi√°</th>
                <th scope="col" class="text-end">T·ªìn kho</th>
                <th scope="col">Tr·∫°ng th√°i</th>
                <th scope="col" class="text-end">H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.ProductList.Count == 0)
            {
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">
                        Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o. <a asp-page="Create">Th√™m s·∫£n ph·∫©m m·ªõi</a>
                    </td>
                </tr>
            }
            else
            {
                @foreach (var product in Model.ProductList)
                {
                    var rowClass = product.StockStatus switch
                    {
                        "OutOfStock" => "table-danger",
                        "Critical" => "table-warning",
                        "Warning" => "table-info",
                        _ => ""
                    };

                    <tr class="@rowClass">
                        <td>
                            <strong>@product.Name</strong>
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(product.Category))
                            {
                                <span class="badge bg-secondary">@product.Category</span>
                            }
                        </td>
                        <td class="text-end">@product.Price.ToString("N0") ƒë</td>
                        <td class="text-end">
                            <strong>@product.StockQuantity</strong> @product.Unit
                            <br />
                            <small class="text-muted">
                                Min: @product.MinimumStock / Reorder: @product.ReorderLevel
                            </small>
                        </td>
                        <td>
                            @switch (product.StockStatus)
                            {
                                case "OutOfStock":
                                    <span class="badge bg-danger">üî¥ H·∫øt h√†ng</span>
                                    break;
                                case "Critical":
                                    <span class="badge bg-warning text-dark">üü† Nguy c·∫•p</span>
                                    break;
                                case "Warning":
                                    <span class="badge bg-info text-dark">üü° C·∫£nh b√°o</span>
                                    break;
                                default:
                                    <span class="badge bg-success">üü¢ ƒê·ªß h√†ng</span>
                                    break;
                            }
                        </td>
                        <td class="text-end">
                            <form method="post" class="d-inline">
                                <a asp-page="./Edit" asp-route-id="@product.Id"
                                   class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-pencil"></i> S·ª≠a
                                </a>
                                <button type="submit" asp-page-handler="Delete" asp-route-id="@product.Id"
                                        class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')">
                                    <i class="bi bi-trash"></i> X√≥a
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@* ‚≠ê TH√äM: Footer th·ªëng k√™ *@
<div class="d-flex justify-content-between align-items-center mt-3">
    <div>
        <strong>T·ªïng:</strong> @Model.ProductList.Count s·∫£n ph·∫©m |
        <strong>Gi√° tr·ªã t·ªìn kho:</strong> @Model.TotalValue.ToString("N0") ƒë
    </div>
    <div>
        <a asp-page="Alerts" class="btn btn-sm btn-outline-warning">
            <i class="bi bi-exclamation-triangle"></i> Xem c·∫£nh b√°o
        </a>
    </div>
</div>