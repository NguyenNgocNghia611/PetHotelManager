@page
@model PetHotelManager.Pages.Invoices.IndexModel
@{
    ViewData["Title"] = "Hóa đơn";
}

<div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0">Hóa đơn</h2>
    @if (Model.IsAdminOrStaff)
    {
        <form method="get" class="d-flex gap-2">
            <input name="UserId" class="form-control form-control-sm" placeholder="Lọc theo UserId" value="@Model.UserId" />
            <input type="hidden" name="PageSize" value="@Model.PageSize" />
            <button class="btn btn-sm btn-outline-primary">Lọc</button>
        </form>
    }
</div>

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger">@Model.Error</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ngày</th>
                    <th>Khách hàng</th>
                    <th>Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            @if (Model.Invoices?.Count > 0)
            {
                foreach (var i in Model.Invoices)
                {
                    <tr>
                        <td>@i.Id</td>
                        <td>@i.InvoiceDate.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@i.CustomerName (@i.CustomerId)</td>
                        <td>@i.TotalAmount.ToString("n0")</td>
                        <td><span class="badge bg-secondary">@i.Status</span></td>
                        <td>
                            <a asp-page="./Details" asp-route-id="@i.Id" class="btn btn-sm btn-outline-secondary">Chi tiết</a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6" class="text-center text-muted">Không có dữ liệu</td></tr>
            }
            </tbody>
        </table>
    </div>

    <nav aria-label="pagination">
        <ul class="pagination pagination-sm">
            <li class="page-item @(Model.PageNumber <= 1 ? "disabled" : "")">
                <a class="page-link" href="?PageNumber=@(Model.PageNumber - 1)&PageSize=@Model.PageSize&UserId=@Model.UserId">Trước</a>
            </li>
            <li class="page-item disabled">
                <span class="page-link">Trang @Model.PageNumber</span>
            </li>
            <li class="page-item @((Model.Invoices == null || !Model.Invoices.HasNextPage) ? "disabled" : "")">
                <a class="page-link" href="?PageNumber=@(Model.PageNumber + 1)&PageSize=@Model.PageSize&UserId=@Model.UserId">Sau</a>
            </li>
        </ul>
    </nav>
}