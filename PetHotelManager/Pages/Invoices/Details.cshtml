@page "{id:int}"
@model PetHotelManager.Pages.Invoices.DetailsModel
@{
    ViewData["Title"] = Model.Invoice != null ? $"Chi tiết Hóa đơn #{Model.Invoice.Id}" : "Chi tiết Hóa đơn";
}

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger">@Model.Error</div>
}
else if (Model.Invoice != null)
{
    <div class="d-flex justify-content-between align-items-center">
        <h1>@ViewData["Title"]</h1>
        <div class="d-flex gap-2">
            <a asp-page="./Index" class="btn btn-secondary">Quay lại danh sách</a>
            <button onclick="window.print()" class="btn btn-primary">In Hóa đơn</button>
        </div>
    </div>
    <hr />

    <div class="card shadow-sm">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6">
                    <strong>Ngày tạo:</strong> @Model.Invoice.InvoiceDate.ToLocalTime().ToString("dd/MM/yyyy HH:mm")
                </div>
                <div class="col-md-6 text-md-end">
                    <strong>Trạng thái:</strong>
                    <span class="badge @(Model.Invoice.Status == "Paid" ? "bg-success" : (Model.Invoice.Status == "Cancelled" ? "bg-danger" : "bg-warning"))">
                        @Model.Invoice.Status
                    </span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <h5>Thông tin Khách hàng</h5>
            <p>
                <strong>Tên:</strong> @Model.Invoice.Customer.Name<br />
                <strong>Số điện thoại:</strong> @Model.Invoice.Customer.Phone
            </p>
            <hr />
            <h5>Chi tiết Dịch vụ / Sản phẩm</h5>
            <table class="table table-bordered table-sm">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Tên mục</th>
                        <th class="text-end">Số lượng</th>
                        <th class="text-end">Đơn giá</th>
                        <th class="text-end">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                @{
                    int counter = 1;
                    foreach (var item in Model.Invoice.Details)
                    {
                        <tr>
                            <td>@(counter++)</td>
                            <td>@item.ItemName (@item.Description)</td>
                            <td class="text-end">@item.Quantity</td>
                            <td class="text-end">@item.UnitPrice.ToString("N0")</td>
                            <td class="text-end">@item.SubTotal.ToString("N0")</td>
                        </tr>
                    }
                }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="text-end fw-bold">TỔNG CỘNG</td>
                        <td class="text-end fw-bold">@Model.Invoice.TotalAmount.ToString("N0") VNĐ</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning">Không có dữ liệu để hiển thị.</div>
}